#!/bin/bash

# Function to display usage
usage() {
    echo "Usage: $0 [-f filename] [recipient]"
    echo "  -f filename    Specify a file to encrypt."
    echo "  recipient     Specify the recipient's email or ID."
    echo "  If no file is specified, data will be read from stdin."
}

# Check for the presence of at least one argument
if [ $# -lt 1 ]; then
    usage
    exit 1
fi

# Parse command line options
while getopts ":f:" opt; do
  case ${opt} in
    f )
      file_to_encrypt=$OPTARG
      ;;
    \? )
      echo "Invalid option: $OPTARG" 1>&2
      usage
      exit 1
      ;;
    : )
      echo "Invalid option: $OPTARG requires an argument" 1>&2
      usage
      exit 1
      ;;
  esac
done
shift $((OPTIND -1))

# Check for recipient argument
if [ $# -lt 1 ]; then
    echo "Error: No recipient specified."
    usage
    exit 1
fi
recipient="$1"

# Encrypt the file if specified, otherwise encrypt stdin
if [ -n "$file_to_encrypt" ]; then
    if [ ! -f "$file_to_encrypt" ]; then
        echo "Error: File $file_to_encrypt does not exist."
        exit 1
    fi
    gpg --output "${file_to_encrypt}.gpg" --encrypt --recipient "$recipient" "$file_to_encrypt"
    echo "File encrypted successfully: ${file_to_encrypt}.gpg"
else
    gpg --encrypt --armor --recipient "$recipient"
    echo "Content encrypted successfully."
fi